# 보이스 서버 API 명세서 (한국어)

## 개요
이 문서는 보이스 서버 API의 인증, 요청/응답 포맷, 오류 처리, 베스트 프랙티스 등 통합적인 사용법을 제공합니다.

---

## 인증
모든 API 요청에는 HTTP 헤더에 API 키가 필요합니다.
- **헤더:** `x-sup-api-key: [YOUR_API_KEY]`

---

## 엔드포인트

### 1. 텍스트-투-스피치 (TTS)
- **엔드포인트:** `POST /v1/text-to-speech/{voice_id}`
- **Content-Type:** `application/json`
- **인증:** 필수 (`x-sup-api-key`)

#### 요청 본문
| 필드           | 타입     | 필수 | 설명                                                        |
|----------------|----------|------|-------------------------------------------------------------|
| text           | string   | Y   | 변환할 텍스트 (최대 300자)                                  |
| language       | string   | Y   | 언어 코드 (`ko`, `en`, `ja`)                                |
| style          | string   | N   | 감정/스타일 (`neutral`, `happy`, `sad`, `angry` 등)         |
| model          | string   | N   | 음성 모델 (기본값: `sona_speech_1`)                         |
| voice_settings | object   | N   | 고급 음성 설정 (아래 참조)                                   |

#### Voice Settings 오브젝트
| 필드           | 타입   | 설명                                         | 허용 범위   | 기본값 |
|----------------|--------|----------------------------------------------|------------|--------|
| pitch_shift    | int    | 피치 조절(±12단계, 1단계=반음)                | -12 ~ +12  | 0      |
| pitch_variance | float  | 음조 변화 정도(작을수록 평탄, 클수록 풍부)     | 0.1 ~ 2    | 1      |
| speed          | float  | 음성 속도 배율(1보다 작으면 느림, 크면 빠름)   | > 0        | 1      |

##### 예시
```json
{
  "text": "안녕하세요, 수퍼톤 API입니다.",
  "language": "ko",
  "style": "neutral",
  "model": "sona_speech_1",
  "voice_settings": {
    "pitch_shift": 0,
    "pitch_variance": 1,
    "speed": 1
  }
}
```


#### 응답
- **성공:** 오디오 스트림(`audio/wav` 또는 `audio/mpeg`)
- **헤더:** `X-Audio-Length: [float]` (오디오 길이, 초)

##### 성공 예시
- **상태:** 200 OK
- **헤더:**
  - `Content-Type: audio/wav`
  - `X-Audio-Length: 3.42`
- **본문:** 바이너리 오디오 데이터

---

### 2. 음성 길이 예측 (Predict Duration)
- **엔드포인트:** `POST /v1/predict-duration/{voice_id}`
- **Content-Type:** `application/json`
- **인증:** 필수

#### 요청 본문
| 필드    | 타입   | 필수 | 설명                |
|---------|--------|------|---------------------|
| text    | string | 예   | 길이 예측할 텍스트  |
| language| string | 예   | 언어 코드           |

#### 응답
| 필드    | 타입   | 설명                |
|---------|--------|---------------------|
| duration| float  | 예측된 길이(초)     |

##### 예시
```json
{
  "duration": 2.87
}
```

---

## 오류 처리

### HTTP 상태 코드 및 원인
| 코드 | 의미                    | 주요 원인 및 해결책                                                         |
|------|-------------------------|------------------------------------------------------------------------------|
| 400  | 잘못된 요청             | 필수값 누락, 300자 초과, 잘못된 style/model, 범위 초과, JSON 오류 등         |
| 401  | 인증 실패               | API 키 누락/오류                                                             |
| 402  | 결제 필요               | 크레딧 부족, 미구매                                                          |
| 403  | 권한 없음               | 권한 없는 리소스 접근                                                        |
| 404  | 찾을 수 없음            | 잘못된 voice_id, 엔드포인트                                                  |
| 408  | 요청 시간 초과          | 네트워크 문제, 과도한 요청                                                   |
| 429  | 요청 한도 초과          | 레이트 리밋 초과                                                             |
| 500  | 서버 내부 오류          | 일시적 서버 문제, 재시도 권장                                                |

#### 오류 응답 예시
```json
{
  "error": "필수 필드 누락: text"
}
```

---

## 베스트 프랙티스
- 요청 전 입력값(텍스트 길이, 언어, 스타일 등) 검증 권장
- 모든 오류 코드에 대한 예외 처리 및 사용자 안내 필요
- `X-Audio-Length` 헤더로 오디오 재생 타이밍 관리
- API 키는 안전하게 보관/관리
- 429 오류 발생 시 재시도(백오프) 로직 구현

---

## 참고
- [수퍼톤 공식 문서](https://docs.supertoneapi.com/en/user-guide/text-to-speech)
- 추가 문의는 API 제공자에 연락 